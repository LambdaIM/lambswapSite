{"version":3,"sources":["webpack:///./src/contacthelp/useApproveCallback.js","webpack:///./src/views/earn/rewardMine/dialog/pledgeDialog.vue?2460","webpack:///./src/views/earn/rewardMine/dialog/index.js","webpack:///./src/views/earn/rewardMine/dialog","webpack:///./src/views/earn/rewardMine/dialog/pledgeDialog.vue?5862","webpack:///./src/views/earn/rewardMine/dialog/pledgeDialog.vue?9630","webpack:///./src/assets/img/arrow-left.svg"],"names":["useApproveCallback","account","library","amountToApprove","spender","token","TokenAmount","undefined","tokenContract","useTokenContract","address","useExact","estimateGas","approve","MaxUint256","catch","raw","toString","estimatedGas","Promise","resolve","reject","gasLimit","calculateGasMargin","then","response","summary","currency","symbol","approval","tokenAddress","hash","error","render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","model","value","callback","$$v","openPledgeDialog","expression","_v","_s","$t","data","name","LPTokenbalance","directives","rawName","modifiers","domProps","on","checkApprove","$event","target","composing","pledgeAmount","_n","handleInput","$forceUpdate","percentage","totalSupply","nativeOn","approveTx","_e","needApprove","showConfirnDialog","showPledgeDialog","img1","img2","increaseRate","fee","sendLoading","confirmSendTx","staticRenderFns","BigNumber","require","config","DECIMAL_PLACES","ROUNDING_MODE","ROUND_DOWN","components","Buttons","isShowPledge","approveLoading","previousData","tokenObj","amountApproveObj","computed","mapState","inputAmount","amountStake","rate","div","plus","decimalPlaces","toNumber","numeral","format","methods","checkData","getFee","open","toExchange","$router","push","val","balance","percent","multipliedBy","num","amount","web3","utils","toWei","tokenJson","stakingRewardsContract","useStakingRewardsContractSigna","ethersprovider","ethAddress","stake","esGas","getGasPrice","gasPrice","bigGasPrice","bigGas","bigchainTokenPrice","chainTokenPrice","times","e","stringValue","regex","match","debounce","chainId","ethChainID","LPTokenAddress","decimals","tokenData","Token","dataAddress","useNeedApproveInput","result","wait","bigBalance","$Notice","warning","title","desc","parseFloat","isGreaterThan","event","$emit","okinfo","failinfo","watch","component","module","exports"],"mappings":"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","file":"js/chunk-c915e6f6.c6ae6614.js","sourcesContent":["import { MaxUint256 } from \"@ethersproject/constants\";\nimport {\n  TokenAmount,\n} from \"@webfans/uniswapsdk\";\nimport { calculateGasMargin } from \"./utils\";\nimport { useTokenContract } from \"./useContract\";\n\nexport async function useApproveCallback(\n  account,\n  library,\n  amountToApprove,\n  spender\n) {\n  const token =\n    amountToApprove instanceof TokenAmount ? amountToApprove.token : undefined;\n  const tokenContract = useTokenContract(library, account, token.address);\n  if (!token) {\n    console.error(\"no token\");\n    return;\n  }\n\n  if (!tokenContract) {\n    console.error(\"tokenContract is null\");\n    return;\n  }\n\n  if (!amountToApprove) {\n    console.error(\"missing amount to approve\");\n    return;\n  }\n\n  if (!spender) {\n    console.error(\"no spender\");\n    return;\n  }\n\n  let useExact = false;\n  const estimatedGas = await tokenContract.estimateGas\n    .approve(spender, MaxUint256)\n    .catch(() => {\n      // general fallback for tokens who restrict approval amounts\n      useExact = true;\n      return tokenContract.estimateGas.approve(\n        spender,\n        amountToApprove.raw.toString()\n      );\n    });\n\n  return new Promise((resolve, reject) => {\n    tokenContract\n      .approve(spender, useExact ? amountToApprove.raw.toString() : MaxUint256, {\n        gasLimit: calculateGasMargin(estimatedGas)\n      })\n      .then(response => {\n        resolve({\n          summary: \"Approve \" + amountToApprove.currency.symbol,\n          approval: { tokenAddress: token.address, spender: spender },\n          hash: response.hash,\n          response: response\n        });\n      })\n      .catch(error => {\n        console.debug(\"Failed to approve token\", error);\n        reject(error);\n      });\n\n  });\n\n}\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"pledge-dialog\"},[_c('Modal',{attrs:{\"class-name\":\"pledge-modal\",\"transfer\":false,\"footer-hide\":true,\"closable\":true},model:{value:(_vm.openPledgeDialog),callback:function ($$v) {_vm.openPledgeDialog=$$v},expression:\"openPledgeDialog\"}},[(_vm.isShowPledge)?_c('div',{staticClass:\"pledge-content\"},[_c('p',{staticClass:\"title text-center\"},[_vm._v(\" \"+_vm._s(_vm.$t('earn.card.stake'))+\" \"+_vm._s(_vm.data.name)+\" \")]),_c('div',{staticClass:\"pledge-wrapper\"},[_c('div',{staticClass:\"title-content\"},[_c('span',{staticClass:\"card-title\"},[_vm._v(_vm._s(_vm.$t('earn.dialog.stakeDialog.amount')))]),_c('div',{staticClass:\"balance-item\"},[_c('span',{staticClass:\"mr-2 text-secondary\"},[_vm._v(_vm._s(_vm.data.name)+\" \"+_vm._s(_vm.$t('earn.dialog.stakeDialog.balance')))]),_c('span',[_vm._v(_vm._s(_vm.data.data && _vm.data.data.LPTokenbalance))])])]),_c('div',{staticClass:\"pledge-wrapper flex\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.pledgeAmount),expression:\"pledgeAmount\",modifiers:{\"number\":true}}],staticClass:\"amount-input\",attrs:{\"type\":\"number\"},domProps:{\"value\":(_vm.pledgeAmount)},on:{\"keyup\":_vm.checkApprove,\"input\":[function($event){if($event.target.composing){ return; }_vm.pledgeAmount=_vm._n($event.target.value)},_vm.handleInput],\"blur\":function($event){return _vm.$forceUpdate()}}})]),_c('div',{staticClass:\"percentage\"},[_c('div',{on:{\"click\":function($event){return _vm.percentage(0.25)}}},[_vm._v(\" 25% \")]),_c('div',{on:{\"click\":function($event){return _vm.percentage(0.5)}}},[_vm._v(\" 50% \")]),_c('div',{on:{\"click\":function($event){return _vm.percentage(0.75)}}},[_vm._v(\" 75% \")]),_c('div',{on:{\"click\":function($event){return _vm.percentage(1)}}},[_vm._v(\" \"+_vm._s(_vm.$t('earn.dialog.stakeDialog.max'))+\" \")])])]),_c('div',{staticClass:\"price-wrapper\"},[_c('div',{staticClass:\"price-item\"},[_c('span',[_vm._v(_vm._s(_vm.$t('earn.dialog.stakeDialog.totalStakePool')))]),_c('p',[_vm._v(_vm._s(_vm.data.data && _vm.data.data.totalSupply)+\" \"+_vm._s(_vm.data.name))])]),_c('div',{staticClass:\"price-item\"},[_c('span',[_vm._v(_vm._s(_vm.$t('earn.dialog.stakeDialog.willStake')))]),_c('p',[_vm._v(_vm._s(_vm.pledgeAmount || 0)+\" \"+_vm._s(_vm.data.name))])])]),_c('div',{staticClass:\"btn-wrapper\"},[(_vm.needApprove)?[(_vm.approveLoading)?_c('Buttons',{staticClass:\"dialogBtn\"},[_vm._v(\" \"+_vm._s(_vm.$t('earn.dialog.loading'))+\" \")]):_c('Buttons',{staticClass:\"dialogBtn\",nativeOn:{\"click\":function($event){return _vm.approveTx($event)}}},[_vm._v(\" \"+_vm._s(_vm.$t('earn.dialog.stakeDialog.approve'))+\" \")])]:_vm._e(),(!_vm.needApprove)?[_c('Buttons',{nativeOn:{\"click\":function($event){return _vm.showConfirnDialog($event)}}},[_vm._v(\" \"+_vm._s(_vm.$t('earn.dialog.stakeDialog.next'))+\" \")])]:_vm._e()],2)]):_c('div',[_c('div',{staticClass:\"confirmPledge-content\"},[_c('div',{staticClass:\"arrow-wrapper\",on:{\"click\":_vm.showPledgeDialog}},[_c('img',{attrs:{\"src\":require(\"../../../../assets/img/arrow-left.svg\"),\"alt\":\"arrow-left\"}})]),_c('p',{staticClass:\"title text-center\"},[_vm._v(\" \"+_vm._s(_vm.$t('earn.dialog.stakeDialog.confirm'))+\" \")]),_c('div',{staticClass:\"confirm-content\"},[_c('div',{staticClass:\"images-wrapper items-center\"},[_c('img',{attrs:{\"src\":_vm.data.img1,\"alt\":\"comp\"}}),_c('img',{staticClass:\"img2\",attrs:{\"src\":_vm.data.img2,\"alt\":\"comp\"}})]),_c('h2',[_vm._v(_vm._s(_vm.pledgeAmount))]),_c('p',[_vm._v(_vm._s(_vm.data.name))]),_c('span',[_vm._v(_vm._s(_vm.$t('earn.dialog.stakeDialog.willMine')))])]),_c('div',{staticClass:\"price-wrapper\"},[_c('div',[_c('span',[_vm._v(_vm._s(_vm.$t('earn.dialog.stakeDialog.asset')))]),_c('div',[_c('div',{staticClass:\"images-wrapper\"},[_c('img',{attrs:{\"src\":_vm.data.img1,\"width\":\"14\",\"alt\":\"comp\"}}),_c('img',{staticClass:\"img2\",attrs:{\"src\":_vm.data.img2,\"width\":\"14\",\"alt\":\"comp\"}})]),_c('p',[_vm._v(_vm._s(_vm.data.name))])])]),_c('div',[_c('span',[_vm._v(_vm._s(_vm.$t('earn.dialog.stakeDialog.sharePool')))]),_c('p',[_vm._v(_vm._s(_vm.increaseRate))])]),_c('div',[_c('span',[_vm._v(\"Fee\")]),_c('p',[_vm._v(\"$\"+_vm._s(_vm.fee))])])]),(_vm.sendLoading === false)?_c('Buttons',{nativeOn:{\"click\":function($event){return _vm.confirmSendTx($event)}}},[_vm._v(\" \"+_vm._s(_vm.$t('earn.dialog.stakeDialog.confirm'))+\" \")]):_c('Buttons',[_vm._v(\" \"+_vm._s(_vm.$t('earn.dialog.loading'))+\" \")])],1)])])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { mapState } from 'vuex';\nconst BigNumber = require('bignumber.js');\nBigNumber.config({ DECIMAL_PLACES: 6, ROUNDING_MODE: BigNumber.ROUND_DOWN });\nimport numeral from 'numeral';\nimport { debounce } from 'debounce';\nimport { TokenAmount, Token } from '@webfans/uniswapsdk';\nimport { useNeedApproveInput } from '@/contacthelp/useNeedApprove.js';\nimport { useApproveCallback } from '@/contacthelp/useApproveCallback.js';\nimport { useStakingRewardsContractSigna } from '../../utils/helpUtils/allowances';\nimport event from '@/common/js/event';\nimport { getGasPrice } from '@/contacthelp/ethusdt.js';\nexport default {\n    components: {\n        Buttons: () =>\n            import ('@/components/basic/buttons'),\n    },\n    data() {\n        return {\n            openPledgeDialog: false,\n            isShowPledge: true,\n            pledgeAmount: '',\n            data: {},\n            needApprove: false,\n            approveLoading: false,\n            previousData: '',\n            tokenObj: {},\n            amountApproveObj: {},\n            sendLoading: false,\n            fee: ''\n        };\n    },\n    computed: {\n        ...mapState(['ethersprovider', 'ethAddress', 'ethChainID', 'web3', 'chainTokenPrice']),\n        increaseRate() {\n            const inputAmount = new BigNumber(this.pledgeAmount);\n            const amountStake = new BigNumber(this.data && this.data.data && this.data.data.totalSupply);\n            const rate = inputAmount.div(amountStake.plus(inputAmount)).decimalPlaces(6).toNumber();\n            // console.log({rate});\n            return numeral(rate).format('0.[0000]%');\n        },\n        // totalRate() {\n        //   const inputAmount = new BigNumber(this.pledgeAmount);\n        //   const balanceAmount = new BigNumber(this.data && this.data.data && this.data.data.LPTokenbalance);\n        //   const amountStake = new BigNumber(this.data && this.data.data && this.data.data.totalSupply);\n        //   const rate = inputAmount.div(balanceAmount.plus(amountStake).plus(inputAmount)).decimalPlaces(6).toNumber();\n        //   // console.log({rate});\n        //   return numeral(rate).format('0.[0000]%');\n        // },\n    },\n    methods: {\n        showConfirnDialog() {\n            if (!this.checkData()) {\n                return false;\n            }\n            this.getFee();\n            this.isShowPledge = false;\n        },\n        showPledgeDialog() {\n            this.isShowPledge = true;\n        },\n        open(data) {\n            this.data = {};\n            this.data = data;\n            this.pledgeAmount = '';\n            this.isShowPledge = true;\n            this.openPledgeDialog = true;\n        },\n        toExchange() {\n            this.$router.push('/exchange');\n        },\n        percentage(val) {\n            const balance = new BigNumber(this.data.data.LPTokenbalance);\n            const percent = new BigNumber(val);\n            this.pledgeAmount = balance.multipliedBy(percent).decimalPlaces(6).toNumber();\n        },\n\n        // 获取手续费\n        async getFee() {\n            // console.log(this.pledgeAmount);\n            try {\n                const num = this.pledgeAmount.toString();\n                const amount = this.web3.utils.toWei(num, 'ether');\n                const tokenJson = this.data;\n                // console.log(tokenJson,num,amount);\n                const stakingRewardsContract = useStakingRewardsContractSigna(this.ethersprovider, this.ethAddress, tokenJson);\n                const esGas = await stakingRewardsContract.estimateGas.stake(amount);\n                const gasPrice = await getGasPrice(this.ethersprovider);\n                const bigGasPrice = new BigNumber(gasPrice);\n                const bigGas = new BigNumber(esGas.toString());\n                const bigchainTokenPrice = new BigNumber(this.chainTokenPrice);\n                const fee = bigGas.times(bigchainTokenPrice).times(bigGasPrice).div('1e18');\n                console.log({ esGas, gasPrice });\n                this.fee = fee.decimalPlaces(6).toNumber();\n            } catch (error) {\n                console.log(error);\n            }\n\n        },\n\n        // 限制Input输入小数点的长度\n        handleInput(e) {\n            const stringValue = e.target.value.toString();\n            const regex = /^\\d*(\\.\\d{1,6})?$/;\n            if (!stringValue.match(regex) && this.pledgeAmount !== '') {\n                this.pledgeAmount = this.previousData;\n            }\n            this.previousData = this.pledgeAmount;\n        },\n\n        // 检查授权\n        checkApprove: debounce(async function() {\n            try {\n                const chainId = this.ethChainID;\n                const address = this.data && this.data.data && this.data.data.LPTokenAddress;\n                const decimals = this.data && this.data.decimals;\n                const symbol = this.data && this.data.symbol;\n                const tokenData = new Token(chainId, address, decimals, symbol);\n\n                // 需要将数据转为字符串格式\n                const amount = this.pledgeAmount.toString();\n                const amountToApprove = new TokenAmount(tokenData, this.web3.utils.toWei(amount, 'ether'));\n\n                this.tokenObj.dataAddress = this.data && this.data.address;\n                this.tokenObj.amountToApprove = amountToApprove;\n\n                // 检查授权\n                this.needApprove = await useNeedApproveInput(\n                    this.ethAddress,\n                    this.ethersprovider,\n                    amountToApprove,\n                    this.tokenObj.dataAddress\n                );\n                // console.log(this.needApprove);\n            } catch (error) {\n                console.log(error);\n            }\n        }, 800),\n\n        // 授权操作\n        async approveTx() {\n            if (!this.checkData()) {\n                return false;\n            }\n            try {\n                this.approveLoading = true;\n                const result = await useApproveCallback(\n                    this.ethAddress,\n                    this.ethersprovider,\n                    this.tokenObj.amountToApprove,\n                    this.tokenObj.dataAddress\n                );\n                if (result) {\n                    const wait = await result.response.wait([1]);\n                    if (wait) {\n                        this.needApprove = false;\n                        this.approveLoading = false;\n                    }\n                }\n            } catch (error) {\n                this.approveLoading = false;\n                console.log(error);\n            }\n        },\n\n        // 检验数据是否合法\n        checkData() {\n            const balance = this.data && this.data.data.LPTokenbalance;\n            const bigBalance = new BigNumber(balance);\n            const amount = new BigNumber(this.pledgeAmount);\n            if (this.pledgeAmount === '') {\n                this.$Notice.warning({\n                    title: this.$t('notice.n'),\n                    desc: this.$t('notice.n30'),\n                });\n                return false;\n            }\n            if (parseFloat(this.pledgeAmount) <= 0) {\n                this.$Notice.warning({\n                    title: this.$t('notice.n'),\n                    desc: this.$t('notice.n31'),\n                });\n                return false;\n            }\n            // console.log(amount.toNumber(),bigBalance.toNumber(),amount.isGreaterThan(bigBalance));\n            if (amount.isGreaterThan(bigBalance)) {\n                this.$Notice.warning({\n                    title: this.$t('notice.n'),\n                    desc: this.$t('notice.n29'),\n                });\n                return false;\n            }\n\n            return true;\n        },\n\n        // 质押操作\n        async confirmSendTx() {\n            // if (!this.checkData()) {\n            //   return false;\n            // }\n            this.sendLoading = true;\n            const num = this.pledgeAmount.toString();\n            const amount = this.web3.utils.toWei(num, 'ether');\n            const tokenJson = this.data;\n            try {\n                const stakingRewardsContract = useStakingRewardsContractSigna(this.ethersprovider, this.ethAddress, tokenJson);\n                const esGas = await stakingRewardsContract.estimateGas.stake(amount);\n                const result = await stakingRewardsContract.stake(amount, {\n                    gasLimit: esGas\n                });\n                const name = this.data && this.data.name;\n                event.$emit('sendSuccess');\n                event.$emit('sendtx', [\n                    result,\n                    {\n                        okinfo: `${this.$t('common.stake')} ${this.pledgeAmount} ${name} ${this.$t('notice.n42')}`,\n                        failinfo: `${this.$t('common.stake')} ${this.pledgeAmount} ${name} ${this.$t('notice.n43')}`,\n                    },\n                ]);\n            } catch (error) {\n                console.log(error);\n            } finally {\n                this.openPledgeDialog = false;\n                this.sendLoading = false;\n            }\n        },\n    },\n    watch: {\n        pledgeAmount() {\n            this.checkApprove();\n        },\n    },\n};","import mod from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/eslint-loader/index.js??ref--13-0!./index.js?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/eslint-loader/index.js??ref--13-0!./index.js?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./pledgeDialog.vue?vue&type=template&id=2e8978de&scoped=true&\"\nimport script from \"./index.js?vue&type=script&lang=js&\"\nexport * from \"./index.js?vue&type=script&lang=js&\"\nimport style0 from \"./pledgeDialog.vue?vue&type=style&index=0&id=2e8978de&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2e8978de\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./pledgeDialog.vue?vue&type=style&index=0&id=2e8978de&lang=less&scoped=true&\"","module.exports = __webpack_public_path__ + \"img/arrow-left.e1aaf66f.svg\";"],"sourceRoot":""}