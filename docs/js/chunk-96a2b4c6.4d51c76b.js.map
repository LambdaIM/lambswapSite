{"version":3,"sources":["webpack:///./src/contacthelp/Approve.js","webpack:///./src/views/playground/addpair.vue?f749","webpack:///src/views/playground/addpair.vue","webpack:///./src/views/playground/addpair.vue?6c14","webpack:///./src/views/playground/addpair.vue?74d6","webpack:///./src/views/playground/addpair.vue?491c"],"names":["require","useTokenApprove","library","account","token","spender","amount","contract","useTokenContract","address","approveAmount","MaxUint256","estimateGas","approve","gasEstimate","gasLimit","calculateGasMargin","result","useTokenApproveErc20Lambda","fromValue","toValue","useErc20LambdaContract","render","_vm","this","_h","$createElement","_c","_self","_v","staticStyle","model","value","callback","$$v","tokenA","expression","_l","item","key","symbol","attrs","_s","name","directives","rawName","domProps","on","$event","target","composing","tokenAAmount","approveA","tokenB","tokenBAmount","approveB","fee","showConfirmInput","sendTX","staticRenderFns","data","tokenList","parameters","btnloading","methods","getTokens","watch","ethChainID","$data","computed","component"],"mappings":"gQAOkBA,EAAQ,QAEnB,SAAeC,EAAtB,0C,8DAAO,WACHC,EACAC,EACAC,EACAC,EACAC,GALG,oGAOGC,EAAWC,eAAiBN,EAASC,EAASC,EAAMK,SAAS,GAQ7DC,EAAgBC,OAfnB,kBAmBqBJ,EAASK,YAAYC,QAAQR,EAAQK,GAnB1D,cAmBCI,EAnBD,gBAoBgBP,EAASM,QAAQR,EAAQK,EAAc,CACpDK,SAAUC,eAAmBF,KArBhC,OAoBCG,EApBD,6FA2BIA,GA3BJ,0D,wBA+BA,SAAeC,EAAtB,4C,8DAAO,WACLhB,EACAC,EACAC,EACAC,EACAc,EACAC,GANK,kGAQCb,EAAWc,eAAuBnB,EAASC,EAASC,EAAMK,SAAS,GARpE,kBAauBF,EAASK,YAAYC,QAAQR,EAASc,EAAWC,GAbxE,cAaGN,EAbH,gBAcYP,EAASM,QAAQR,EAASc,EAAWC,EAAS,CAC3DL,SAAUC,eAAmBF,KAf5B,OAcHG,EAdG,6FAqBEA,GArBF,0D,mECxCP,IAAIK,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACJ,EAAIM,GAAG,WAAWF,EAAG,SAAS,CAACG,YAAY,CAAC,MAAQ,SAASC,MAAM,CAACC,MAAOT,EAAU,OAAEU,SAAS,SAAUC,GAAMX,EAAIY,OAAOD,GAAKE,WAAW,WAAWb,EAAIc,GAAId,EAAa,WAAE,SAASe,GAAM,OAAOX,EAAG,SAAS,CAACY,IAAID,EAAKE,OAAOC,MAAM,CAAC,MAAQH,EAAKE,SAAS,CAACjB,EAAIM,GAAG,UAAUN,EAAImB,GAAGJ,EAAKK,MAAM,YAAYpB,EAAImB,GAAGJ,EAAKE,QAAQ,UAAS,GAAGb,EAAG,MAAM,CAACA,EAAG,QAAQ,CAACiB,WAAW,CAAC,CAACD,KAAK,QAAQE,QAAQ,UAAUb,MAAOT,EAAgB,aAAEa,WAAW,iBAAiBU,SAAS,CAAC,MAASvB,EAAgB,cAAGwB,GAAG,CAAC,MAAQ,SAASC,GAAWA,EAAOC,OAAOC,YAAqB3B,EAAI4B,aAAaH,EAAOC,OAAOjB,WAAUL,EAAG,SAAS,CAACoB,GAAG,CAAC,MAAQxB,EAAI6B,WAAW,CAAC7B,EAAIM,GAAG,OAAON,EAAImB,GAAGnB,EAAIY,SAASR,EAAG,cAAcA,EAAG,SAAS,CAACG,YAAY,CAAC,MAAQ,SAASC,MAAM,CAACC,MAAOT,EAAU,OAAEU,SAAS,SAAUC,GAAMX,EAAI8B,OAAOnB,GAAKE,WAAW,WAAWb,EAAIc,GAAId,EAAa,WAAE,SAASe,GAAM,OAAOX,EAAG,SAAS,CAACY,IAAID,EAAKE,OAAOC,MAAM,CAAC,MAAQH,EAAKE,SAAS,CAACjB,EAAIM,GAAG,UAAUN,EAAImB,GAAGJ,EAAKK,MAAM,YAAYpB,EAAImB,GAAGJ,EAAKE,QAAQ,UAAS,GAAGb,EAAG,MAAM,CAACA,EAAG,QAAQ,CAACiB,WAAW,CAAC,CAACD,KAAK,QAAQE,QAAQ,UAAUb,MAAOT,EAAgB,aAAEa,WAAW,iBAAiBU,SAAS,CAAC,MAASvB,EAAgB,cAAGwB,GAAG,CAAC,MAAQ,SAASC,GAAWA,EAAOC,OAAOC,YAAqB3B,EAAI+B,aAAaN,EAAOC,OAAOjB,WAAUL,EAAG,SAAS,CAACoB,GAAG,CAAC,MAAQxB,EAAIgC,WAAW,CAAChC,EAAIM,GAAG,OAAON,EAAImB,GAAGnB,EAAI8B,SAAS1B,EAAG,cAAcA,EAAG,MAAM,CAACJ,EAAIM,GAAG,OAAON,EAAImB,GAAGnB,EAAIiC,QAAQ7B,EAAG,MAAM,CAACA,EAAG,SAAS,CAACoB,GAAG,CAAC,MAAQxB,EAAIkC,mBAAmB,CAAClC,EAAIM,GAAG,cAAcF,EAAG,MAAMA,EAAG,MAAM,CAACA,EAAG,SAAS,CAACoB,GAAG,CAAC,MAAQxB,EAAImC,SAAS,CAACnC,EAAIM,GAAG,eAAe,IACnoD8B,EAAkB,G,uJCkEtB,GACEC,KADF,WAEI,MAAO,CACLC,UAAW,GACX1B,OAAQ,GACRkB,OAAQ,GACRF,aAAc,GACdG,aAAc,GACdQ,WAAY,GACZN,IAAK,GACLO,YAAY,IAGhBC,QAAS,CACPC,UADJ,WAGM,IAAN,kBACA,gBACA,oBACM,OAAO,OAAb,OAAa,CAAb,IAEI,iBARJ,WAQA,6LAGA,eACA,mBACA,eAEA,mCACA,mCAEA,uBACA,uBAEA,uBACA,EACA,4BAGA,uBACA,EACA,4BAIA,oBACA,qBACA,4BACA,6BACA,sBAEA,6BACA,qBAGA,sBAlCA,oBAoCA,eACA,EACA,EACA,EACA,GAxCA,eAoCA,EApCA,OA2CA,qBA3CA,UA6CA,eACA,EACA,EACA,EACA,EACA,GAlDA,QA6CA,EA7CA,OAuDA,cACA,iBAxDA,sDA2DA,iBACA,qCA5DA,QA+DA,sBA/DA,8DAiEI,OAzEJ,WAyEA,+KACA,eACA,mBACA,eAEA,qBAMA,sBAXA,kBAaA,eACA,EACA,EACA,EACA,EACA,mBAlBA,OAaA,EAbA,OAqBA,EArBA,UAqBA,wBArBA,YAsBA,sCAtBA,YAuBA,sBAvBA,YAuBA,sBAvBA,QAwBA,2BACA,sBACA,EACA,CACA,qCACA,uCAGA,2BAhCA,qDAkCA,iBACA,qCAnCA,QAsCA,sBAtCA,6DAwCI,SAjHJ,WAiHA,mLACA,eACA,mBACA,eACA,mCAEA,uBACA,qBAIA,SACA,sBAZA,UAcA,0BAdA,WAcA,EAdA,QAgBA,EAhBA,kCAiBA,YAjBA,eAmBA,yBAnBA,wBAuBA,iBACA,qCAxBA,QA2BA,sBA3BA,+CA6BI,SA9IJ,WA8IA,iLACA,eACA,mBACA,eAMA,mCAEA,uBAEA,qBAEA,SAEA,sBAjBA,UAmBA,0BAnBA,+DAwBEC,MAAO,CACLC,WAAY,WACV3C,KAAK4C,MAAMP,UAAYrC,KAAKyC,cAGhCI,SAAU,OAAZ,OAAY,CAAZ,GACA,sEC5PgW,I,wBCQ5VC,EAAY,eACd,EACAhD,EACAqC,GACA,EACA,KACA,WACA,MAIa,aAAAW,E,kECnBf","file":"js/chunk-96a2b4c6.4d51c76b.js","sourcesContent":["import { Token, TokenAmount } from \"@webfans/uniswapsdk\";\nimport { MaxUint256, Zero} from \"@ethersproject/constants\";\nimport { useTokenContract, useErc20LambdaContract } from \"./useContract.js\";\nimport {\n  calculateGasMargin,\n\n} from \"./utils.js\";\nconst BigNumber = require(\"bignumber.js\");\n\nexport async function useTokenApprove(\n    library,\n    account,\n    token,\n    spender,\n    amount\n  ) {\n    const contract = useTokenContract(library, account, token.address, true);\n\n\n    let result,gasEstimate;\n\n    //MaxUint256\n    // const bigAmount = new BigNumber(amount);\n    // const approveAmount = bigAmount.times('1.1').toFixed(0);\n    const approveAmount = MaxUint256;\n    console.log(contract, 3333222);\n\n    try {\n        gasEstimate = await contract.estimateGas.approve(spender,approveAmount);\n        result = await contract.approve(spender,approveAmount,{\n          gasLimit: calculateGasMargin(gasEstimate)\n        });\n    } catch (error) {\n      console.log(error);\n    }\n\n    return result;\n  }\n\n\nexport async function useTokenApproveErc20Lambda(\n  library,\n  account,\n  token,\n  spender,\n  fromValue,\n  toValue,\n) {\n  const contract = useErc20LambdaContract(library, account, token.address, true);\n\n  let result;\n  // fromValue = Zero;\n  try {\n    const gasEstimate = await contract.estimateGas.approve(spender, fromValue, toValue);\n    result = await contract.approve(spender, fromValue, toValue, {\n      gasLimit: calculateGasMargin(gasEstimate)\n    });\n  } catch (error) {\n    console.log(error);\n  }\n\n  return result;\n}\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_vm._v(\" 添加交易对 \"),_c('Select',{staticStyle:{\"width\":\"200px\"},model:{value:(_vm.tokenA),callback:function ($$v) {_vm.tokenA=$$v},expression:\"tokenA\"}},_vm._l((_vm.tokenList),function(item){return _c('Option',{key:item.symbol,attrs:{\"value\":item.symbol}},[_vm._v(\" name: \"+_vm._s(item.name)+\" ,symbol:\"+_vm._s(item.symbol)+\" \")])}),1),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.tokenAAmount),expression:\"tokenAAmount\"}],domProps:{\"value\":(_vm.tokenAAmount)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.tokenAAmount=$event.target.value}}}),_c('button',{on:{\"click\":_vm.approveA}},[_vm._v(\" 授权 \"+_vm._s(_vm.tokenA)),_c('button')])]),_c('Select',{staticStyle:{\"width\":\"200px\"},model:{value:(_vm.tokenB),callback:function ($$v) {_vm.tokenB=$$v},expression:\"tokenB\"}},_vm._l((_vm.tokenList),function(item){return _c('Option',{key:item.symbol,attrs:{\"value\":item.symbol}},[_vm._v(\" name: \"+_vm._s(item.name)+\" ,symbol:\"+_vm._s(item.symbol)+\" \")])}),1),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.tokenBAmount),expression:\"tokenBAmount\"}],domProps:{\"value\":(_vm.tokenBAmount)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.tokenBAmount=$event.target.value}}}),_c('button',{on:{\"click\":_vm.approveB}},[_vm._v(\" 授权 \"+_vm._s(_vm.tokenB)),_c('button')])]),_c('div',[_vm._v(\"fee:\"+_vm._s(_vm.fee))]),_c('div',[_c('button',{on:{\"click\":_vm.showConfirmInput}},[_vm._v(\" 拼接参数 \")])]),_c('br'),_c('div',[_c('button',{on:{\"click\":_vm.sendTX}},[_vm._v(\" 发送交易 \")])])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div>\n    添加交易对\n    <Select v-model=\"tokenA\" style=\"width: 200px\">\n      <Option v-for=\"item in tokenList\" :key=\"item.symbol\" :value=\"item.symbol\">\n        name: {{ item.name }} ,symbol:{{ item.symbol }}\n      </Option>\n    </Select>\n\n    <div>\n      <input v-model=\"tokenAAmount\">\n      <button @click=\"approveA\">\n        授权 {{ tokenA }}<button />\n      </button>\n    </div>\n    <Select v-model=\"tokenB\" style=\"width: 200px\">\n      <Option v-for=\"item in tokenList\" :key=\"item.symbol\" :value=\"item.symbol\">\n        name: {{ item.name }} ,symbol:{{ item.symbol }}\n      </Option>\n    </Select>\n    <div>\n      <input v-model=\"tokenBAmount\">\n      <button @click=\"approveB\">\n        授权 {{ tokenB }}<button />\n      </button>\n    </div>\n    <div>fee:{{ fee }}</div>\n    <div>\n      <button @click=\"showConfirmInput\">\n        拼接参数\n      </button>\n    </div>\n    <br>\n    <div>\n      <button @click=\"sendTX\">\n        发送交易\n      </button>\n    </div>\n  </div>\n</template>\n<script>\nimport { mapState } from \"vuex\";\nimport { getTokenList } from \"@/contactLogic/readpairpool.js\";\nimport { TokenAmount } from \"@webfans/uniswapsdk\";\nimport getChainCoinInfo from \"@/constants/networkCoinconfig.js\";\n\nimport {\n  readpariInfoNuminfo,\n  calculationLiquidity,\n  checkApprove,\n  buildAddliquidityParam,\n  addliquidityGas,\n  sendaddliquidity,\n} from \"@/contactLogic/readpairpool.js\";\n\nimport {\n  getTokenImg,\n  readSwapBalance,\n  getToken,\n} from \"@/contactLogic/readbalance.js\";\n\nimport Web3 from \"web3\";\nimport { ROUTER_ADDRESS } from '@/constants/index.js';\n\nimport { useTokenApprove } from '@/contacthelp/Approve.js';\n\n\nexport default {\n  data() {\n    return {\n      tokenList: [],\n      tokenA: \"\",\n      tokenB: \"\",\n      tokenAAmount: \"\",\n      tokenBAmount: \"\",\n      parameters: [],\n      fee: \"\",\n      btnloading: false,\n    };\n  },\n  methods: {\n    getTokens() {\n      console.log(\"---\");\n      const chainID = this.ethChainID;\n      const account = this.ethAddress;\n      const library = this.ethersprovider;\n      return getTokenList(chainID);\n    },\n    async showConfirmInput() {\n      //构造参数计算手续费\n\n      const chainID = this.ethChainID;\n      const library = this.ethersprovider;\n      const account = this.ethAddress;\n\n      const TokenA = getToken(this.$data.tokenA, chainID);\n      const TokenB = getToken(this.$data.tokenB, chainID);\n\n      const numa = this.$data.tokenAAmount;\n      const numb = this.$data.tokenBAmount;\n\n      const coinATokenAmount = new TokenAmount(\n        TokenA,\n        Web3.utils.toWei(numa, \"ether\")\n      );\n\n      const coinBTokenAmount = new TokenAmount(\n        TokenB,\n        Web3.utils.toWei(numb, \"ether\")\n      );\n\n      let ethamount;\n      const coinInfo = getChainCoinInfo(chainID);\n      this.$data.ethamount = \"\";\n      if (this.$data.tokenA == coinInfo.coinName) {\n        ethamount = Web3.utils.toWei(numa, \"ether\");\n        this.$data.ethamount = ethamount;\n      } else {\n        ethamount = Web3.utils.toWei(numb, \"ether\");\n        this.$data.ethamount = ethamount;\n      }\n\n      this.$data.btnloading = true;\n      try {\n        const parameters = await buildAddliquidityParam(\n          coinATokenAmount,\n          coinBTokenAmount,\n          account,\n          chainID\n        );\n        console.log(parameters);\n        this.$data.parameters = parameters;\n\n        const fee = await addliquidityGas(\n          chainID,\n          library,\n          account,\n          parameters,\n          ethamount\n        );\n\n        console.log(fee);\n\n        this.$data.fee = fee;\n        this.isShowInput = false;\n      } catch (error) {\n        console.log(error);\n        this.$Notice.error({\n          title: this.$t(\"notice.swapNotice.n5\"),\n        });\n      }\n      this.$data.btnloading = false;\n    },\n    async sendTX() {\n      const chainID = this.ethChainID;\n      const library = this.ethersprovider;\n      const account = this.ethAddress;\n\n      const parameters = this.$data.parameters;\n\n      // if (this.checkAmount()) {\n      //   return;\n      // }\n\n      this.$data.btnloading = true;\n      try {\n        const tx = await sendaddliquidity(\n          chainID,\n          library,\n          account,\n          parameters,\n          this.$data.ethamount\n        );\n\n        const baseTip = `${this.$t(\"swapConfirm.add\")} ${\n          this.$data.LiquidityInfo.liquidityMinted\n        } ${this.$data.tokenA.symbol}/${this.$data.tokenB.symbol} LP `;\n        this.$refs.haveSendtx.open(baseTip);\n        event.$emit(\"sendtx\", [\n          tx,\n          {\n            okinfo: baseTip + this.$t(\"swapConfirm.success\"),\n            failinfo: baseTip + this.$t(\"swapConfirm.fail\"),\n          },\n        ]);\n        this.$data.openInputDialog = false;\n      } catch (error) {\n        this.$Notice.error({\n          title: this.$t(\"notice.swapNotice.n3\"),\n        });\n      }\n      this.$data.btnloading = false;\n    },\n    async approveA() {\n      const chainID = this.ethChainID;\n      const library = this.ethersprovider;\n      const account = this.ethAddress;\n      const TokenA = getToken(this.$data.tokenA, chainID);\n\n      const numa = this.$data.tokenAAmount;\n      const amount = Web3.utils.toWei(numa);\n\n      \n\n      const spender = ROUTER_ADDRESS;\n      this.$data.btnloading = true;\n\n      const transaction = await useTokenApprove(library, account, TokenA, spender, amount);\n      console.log(transaction);\n      if (transaction) {\n        const waitdata = await transaction.wait([1]);\n        console.log(waitdata);\n        this.$data.tokenAnotNeed = true;\n      } else {\n        //取消授权\n        //需要提示\n        this.$Notice.error({\n          title: this.$t('notice.swapNotice.n4'),\n        });\n      }\n      this.$data.btnloading = false;\n    },\n    async approveB() {\n      const chainID = this.ethChainID;\n      const library = this.ethersprovider;\n      const account = this.ethAddress;\n\n      // if (this.checkAmount()) {\n      //   return;\n      // }\n\n      const TokenB = getToken(this.$data.tokenB, chainID);\n\n      const numb = this.$data.tokenBAmount;\n\n      const amount = Web3.utils.toWei(numb);\n\n      const spender = ROUTER_ADDRESS;\n\n      this.$data.btnloading = true;\n\n      const transaction = await useTokenApprove(library, account, TokenB, spender, amount);\n      console.log(transaction);\n      \n    },\n  },\n  watch: {\n    ethChainID: function () {\n      this.$data.tokenList = this.getTokens();\n    },\n  },\n  computed: {\n    ...mapState([\"ethAddress\", \"ethChainID\", \"web3\", \"ethersprovider\"]),\n  },\n};\n</script>\n<style lang=\"less\" scoped>\ninput{\n  border: 1px solid salmon;\n}\n</style>\n\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./addpair.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./addpair.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./addpair.vue?vue&type=template&id=74dc42cc&scoped=true&\"\nimport script from \"./addpair.vue?vue&type=script&lang=js&\"\nexport * from \"./addpair.vue?vue&type=script&lang=js&\"\nimport style0 from \"./addpair.vue?vue&type=style&index=0&id=74dc42cc&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"74dc42cc\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./addpair.vue?vue&type=style&index=0&id=74dc42cc&lang=less&scoped=true&\""],"sourceRoot":""}